<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试 diytitle 功能</title>
</head>
<body>
    <h1>diytitle 功能测试页面</h1>
    <p>请按照以下步骤测试：</p>
    <ol>
        <li>切换到其他标签页或最小化浏览器</li>
        <li>观察标签页标题是否变为："行子匆匆，風流總被吹散"</li>
        <li>重新回到这个标签页</li>
        <li>观察标题是否先显示："別來無恙，蓬門隨時待君测试 diytitle 功能"</li>
        <li>2秒后标题应该恢复为："测试 diytitle 功能"</li>
    </ol>
    
    <div id="status">等待测试...</div>
    
    <script>
        // 模拟AnZhiYu主题的diytitle功能
        const GLOBAL_CONFIG = {
            diytitle: {
                enable: true,
                leaveTitle: "行子匆匆，風流總被吹散",
                backTitle: "別來無恙，蓬門隨時待君"
            }
        };
        
        function changeDocumentTitle() {
            let leaveTitle = GLOBAL_CONFIG.diytitle.leaveTitle;
            let backTitle = GLOBAL_CONFIG.diytitle.backTitle;
            let OriginTitile = document.title;
            let titleTime;
            
            console.log('diytitle功能已启用');
            console.log('原始标题:', OriginTitile);
            console.log('离开标题:', leaveTitle);
            console.log('返回标题:', backTitle);
            
            document.addEventListener("visibilitychange", function () {
                const statusDiv = document.getElementById('status');
                if (document.hidden) {
                    // 离开当前页面时标签显示内容
                    document.title = leaveTitle;
                    statusDiv.textContent = '页面隐藏 - 标题已改为: ' + leaveTitle;
                    console.log('页面隐藏，标题改为:', leaveTitle);
                    clearTimeout(titleTime);
                } else {
                    // 返回当前页面时标签显示内容
                    document.title = backTitle + OriginTitile;
                    statusDiv.textContent = '页面显示 - 标题已改为: ' + backTitle + OriginTitile;
                    console.log('页面显示，标题改为:', backTitle + OriginTitile);
                    // 两秒后变回正常标题
                    titleTime = setTimeout(function () {
                        document.title = OriginTitile;
                        statusDiv.textContent = '2秒后恢复 - 标题已恢复为: ' + OriginTitile;
                        console.log('2秒后恢复标题为:', OriginTitile);
                    }, 2000);
                }
            });
        }
        
        // 启用功能
        if (GLOBAL_CONFIG.diytitle && GLOBAL_CONFIG.diytitle.enable) {
            changeDocumentTitle();
            document.getElementById('status').textContent = 'diytitle功能已启用，请切换标签页测试';
        } else {
            document.getElementById('status').textContent = 'diytitle功能未启用';
        }
    </script>
</body>
</html>
